version: '3.4'

services:
  eventstore:
    image: eventstore
    build:
      context: .
      dockerfile: EventStore.Middleware/Dockerfile
    environment:
    - ASPNETCORE_ENVIRONMENT=Development
    - es_connection=Server=database_sql;Database=event_sourcing;User Id=sa;Password=Pass@word
    depends_on:
    - database_sql
    - distributed_cache
    ports:
    - 32770:80

  vehicle:
    image: vehicle
    build:
      context: .
      dockerfile: Vehicle/Dockerfile
    environment:
    - ASPNETCORE_ENVIRONMENT=Development
    - es_connection=Server=database_sql;Database=event_sourcing;User Id=sa;Password=Pass@word
    - db_connection=Server=database_sql;Database=vehicle;User Id=sa;Password=Pass@word
    depends_on:
    - database_sql  
    - eventstore
    - distributed_cache
    ports:
    - 32772:80

  database_sql:
    image: microsoft/mssql-server-linux:latest
    environment:
    - MSSQL_SA_PASSWORD=Pass@word
    - ACCEPT_EULA=Y
    - MSSQL_PID=Express
    ports:
    - 5553:1433

  distributed_cache:
    image: redis
    ports:
    - 5551:6739
